---
title: "Analiza kriminala i socio-ekonomskih faktora"
author: "Bruno Ćorić, Filip Škrlec, Jelena Matečić, Iva Zekić"
date: "11/6/2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
library(dplyr)
library(knitr)
library(lubridate)
library(magrittr)
library(ggpubr)
knitr::opts_chunk$set(echo = TRUE)
```


## Učitavanje podataka

Imamo dva skupa podataka kriminala i socio-ekonomskih faktora za grad Chicago.


```{r}
crimeDataset <- read.csv("crime_datasets/Crimes_-_One_year_prior_to_present.csv"
                         ,stringsAsFactors = F,na.strings = "")

povertyDataset <- read.csv("crime_datasets/Chicago_poverty_and_crime.csv"
                           ,stringsAsFactors = F, na.strings="")

head(crimeDataset)
head(povertyDataset)

str(crimeDataset)
str(povertyDataset)

```


Faktorizirat ćemo podatke koje bi bilo logično faktorizirati kao što su podaci 
u stupcu Arrest,Domestic.

```{r}
crimeDataset$ARREST <- as.factor(crimeDataset$ARREST)
crimeDataset$DOMESTIC <- as.factor(crimeDataset$DOMESTIC)
```


Provjeravamo fale li nam neki podaci u najbitnim kategorijama u oba dataseta.

```{r}
s <-c(1,2,3,4,5,6,8,9) 
sum(is.na(crimeDataset[s]))
sum(is.na(povertyDataset))
```


## Razlika učestalosti zločina ovisno o tome koje je doba dana

Podijelit ćemo dan na 3 dijela. Od 5 do 13 će biti prvi dio dana. Od 13 do 21
drugi dio dana, a od 21 do 5 treći dio dana.

```{r}

timeOfTheDay <- mdy_hms(crimeDataset$DATE..OF.OCCURRENCE) %>% hour
timeOfTheDay <- sapply(timeOfTheDay, function(x) {
  if(x >= 5 & x < 13) {
    "morning"
  } else if(x >= 13 & x < 21) {
    "afternoon"
  } else {
    "evening"
  }
},simplify="vector")
timeOfTheDay <- as.factor(timeOfTheDay)
crimeDataset$TIME.OF.DAY <- timeOfTheDay
head(crimeDataset[c("DATE..OF.OCCURRENCE","TIME.OF.DAY")])
pie(table(crimeDataset$TIME.OF.DAY))
```



Napravit ćemo test o homogenosti u kojem želimo viditi postoji li razlika u 
količini zločina s obzirom na doba dana.

Napravit ćemo test homogenosti u kojem ćemo provjeriti je li broj zločina 
opasnih po život jednak za sva 3 doba dana. Zločine koje smo uzeli da su 
opasni po život nalaze se u varijabli `dangCrimes`.

```{r, echo=FALSE}
dangCrimes <- c("ARSON", "ASSAULT","BATTERY","BURGLARY","CRIM SEXUAL ASSAULT",
                "CRIMINAL DAMAGE", "CRIMINAL SEXUAL ASSAULT","CRIMINAL TRESPASS"
                , "HOMICIDE","KIDNAPPING")
dangerousCrimes <- ifelse(crimeDataset$PRIMARY.DESCRIPTION %in% dangCrimes
                      ,"dangerous","less dangerous") %>% as.factor
kable(table(dangerousCrimes))
dangerous <- table(crimeDataset$TIME.OF.DAY, dangerousCrimes)
kable(dangerous)
chisq.test(dangerous, correct = FALSE)
```

Zaključujemo da se razlikuje količina opasnih i neopasnih zločina ovisno o tome
koje je doba dana.

##Korelacija između zločina i socio ekonomskih faktora

```{r}

library("ggpubr")
ggscatter(povertyDataset, x = "Assault..Homicide.", y = "Unemployment", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Assaults(Homicide) per 100 000 residents", ylab = "Unemployment percentage")

ggscatter(povertyDataset, x = "Firearm.related", y = "Unemployment", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Firearm-related crimes per 100 000 residents", ylab = "Unemployment percentage")

ggscatter(povertyDataset, x = "Assault..Homicide.", y = "No.High.School.Diploma", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Assaults(Homicide) per 100 000 residents", ylab = "No high school diploma percentage")

ggscatter(povertyDataset, x = "Firearm.related", y = "No.High.School.Diploma", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Firearm-related crimes per 100 000 residents", ylab = "No high school diploma percentage")
ggscatter(povertyDataset, x = "Assault..Homicide.", y = "Per.Capita.Income", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Assaults(Homicide) per 100 000 residents", ylab = "Income per capita")

ggscatter(povertyDataset, x = "Firearm.related", y = "Per.Capita.Income", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Firearm-related crimes per 100 000 residents", ylab = "Income per capita")

ggscatter(povertyDataset, x = "Assault..Homicide.", y = "Crowded.Housing", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Assaults(Homicide) per 100 000 residents", ylab = "Crowded housing percentage")

ggscatter(povertyDataset, x = "Firearm.related", y = "Crowded.Housing", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Firearm-related crimes per 100 000 residents", ylab = "Crowded housing percentage")

ggscatter(povertyDataset, x = "Assault..Homicide.", y = "Below.Poverty.Level", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Assaults(Homicide) per 100 000 residents", ylab = "Percentage of people below poverty level")

ggscatter(povertyDataset, x = "Firearm.related", y = "Below.Poverty.Level", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Firearm-related crimes per 100 000 residents", ylab = "Percentage of people below poverty level")
ggscatter(povertyDataset, x = "Assault..Homicide.", y = "Dependency", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Assaults(Homicide) per 100 000 residents", ylab = "Dependecy percentage")
ggscatter(povertyDataset, x = "Firearm.related", y = "Dependency", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Firearm-related crimes per 100 000 residents", ylab = "Dependecy percentage")
```

## Je li učestalost krađa veća od učestalosti kriminala vezanih za narkotike?

U varijablu 'description' odvajamo objekt PRIMARY.DESCRIPTION iz našeg skupa podataka crimeDataset. Zatim tu varijablu pretvara u skup podataka ali na način da se sve iste vrijednosti prebroje i upišu u stupaca Freq. U varijable krada i narkotici odvojimo podatke vezane za te zlocine. U varijable broj_krada i broj_narkotici zatim stavljamo sumu retka freq iz prethodnih varijabli.


```{r}
description <- crimeDataset$PRIMARY.DESCRIPTION

description <- as.data.frame(table(description))

krada <- description[c(18, 28, 31),]
narkotici <- description[c(19, 23),]

broj_krada <- sum(krada$Freq)
broj_narkotici <- sum(narkotici$Freq)

cat("Učestalost krađa: ")
broj_krada
cat("\n")
cat("Učestalost kriminala vezanih za narkotike: ")
broj_narkotici
cat("\n")
```


```{r jednostavna regresija}

fit.FirearmUnemployment = lm(Firearm.related~Unemployment,data=povertyDataset) #linearni model broja iznajmljenih bicikla (cnt) i temperature tog dana (temp)


plot(povertyDataset$Firearm.related,povertyDataset$Unemployment) #graficki prikaz podataka
lines(povertyDataset$Firearm.related,fit.FirearmUnemployment$fitted.values,col='red') #graficki prikaz procijenjenih vrijednosti iz modela

fit.AssaultUnemployment = lm(Assault..Homicide.~Unemployment,data=povertyDataset) #linearni model broja iznajmljenih bicikla (cnt) i temperature tog dana (temp)


plot(povertyDataset$Assault..Homicide.,povertyDataset$Unemployment) #graficki prikaz podataka
lines(povertyDataset$Assault..Homicide.,fit.AssaultUnemployment$fitted.values,col='red') #graficki prikaz procijenjenih vrijednosti iz modela

selected.model = fit.FirearmUnemployment

plot(selected.model$residuals) #gledajuci reziduale na ovaj nacin tesko je suditi o normalnosti

#histogram je vrlo interpretativan
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot reziduala s linijom normalne distribucije
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

plot(selected.model$fitted.values,selected.model$residuals) #reziduale je dobro prikazati u ovisnosti o procjenama modela

#KS test na normalnost 
ks.test(rstandard(fit.FirearmUnemployment),'pnorm')

require(nortest)
lillie.test(rstandard(fit.FirearmUnemployment))

selected.model = fit.AssaultUnemployment

plot(selected.model$residuals) #gledajuci reziduale na ovaj nacin tesko je suditi o normalnosti

#histogram je vrlo interpretativan
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot reziduala s linijom normalne distribucije
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

plot(selected.model$fitted.values,selected.model$residuals) #reziduale je dobro prikazati u ovisnosti o procjenama modela

#KS test na normalnost 
ks.test(rstandard(fit.AssaultUnemployment),'pnorm')

require(nortest)
lillie.test(rstandard(fit.AssaultUnemployment))

```

```{r jednostavna regresija}

fit.FirearmPoverty = lm(Firearm.related~Below.Poverty.Level,data=povertyDataset) #linearni model broja iznajmljenih bicikla (cnt) i temperature tog dana (temp)


plot(povertyDataset$Firearm.related,povertyDataset$Below.Poverty.Level) #graficki prikaz podataka
lines(povertyDataset$Firearm.related,fit.FirearmPoverty$fitted.values,col='red') #graficki prikaz procijenjenih vrijednosti iz modela

fit.AssaultPoverty = lm(Assault..Homicide.~Below.Poverty.Level,data=povertyDataset) #linearni model broja iznajmljenih bicikla (cnt) i temperature tog dana (temp)


plot(povertyDataset$Assault..Homicide.,povertyDataset$Below.Poverty.Level) #graficki prikaz podataka
lines(povertyDataset$Assault..Homicide.,fit.AssaultPoverty$fitted.values,col='red') #graficki prikaz procijenjenih vrijednosti iz modela

selected.model = fit.FirearmPoverty

plot(selected.model$residuals) #gledajuci reziduale na ovaj nacin tesko je suditi o normalnosti

#histogram je vrlo interpretativan
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot reziduala s linijom normalne distribucije
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

plot(selected.model$fitted.values,selected.model$residuals) #reziduale je dobro prikazati u ovisnosti o procjenama modela

#KS test na normalnost 
ks.test(rstandard(fit.FirearmPoverty),'pnorm')

require(nortest)
lillie.test(rstandard(fit.FirearmPoverty))

selected.model = fit.AssaultPoverty

plot(selected.model$residuals) #gledajuci reziduale na ovaj nacin tesko je suditi o normalnosti

#histogram je vrlo interpretativan
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot reziduala s linijom normalne distribucije
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

plot(selected.model$fitted.values,selected.model$residuals) #reziduale je dobro prikazati u ovisnosti o procjenama modela

#KS test na normalnost 
ks.test(rstandard(fit.AssaultPoverty),'pnorm')

require(nortest)
lillie.test(rstandard(fit.AssaultPoverty))

```