---
title: "Analiza kriminala i socio-ekonomskih faktora"
author: "Bruno Ćorić, Filip Škrlec, Jelena Matečić, Iva Zekić"
date: "11/6/2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
library(dplyr)
library(knitr)
library(lubridate)
library(magrittr)
library(ggpubr)
knitr::opts_chunk$set(echo = TRUE)
```


## Učitavanje podataka

Imamo dva skupa podataka kriminala i socio-ekonomskih faktora za grad Chicago.


```{r}
crimeDataset <- read.csv("crime_datasets/Crimes_-_One_year_prior_to_present.csv"
                         ,stringsAsFactors = F,na.strings = "")

povertyDataset <- read.csv("crime_datasets/Chicago_poverty_and_crime.csv"
                           ,stringsAsFactors = F, na.strings="")

head(crimeDataset)
head(povertyDataset)

str(crimeDataset)
str(povertyDataset)

```


Faktorizirat ćemo podatke koje bi bilo logično faktorizirati kao što su podaci 
u stupcu Arrest,Domestic.

```{r}
crimeDataset$ARREST <- as.factor(crimeDataset$ARREST)
crimeDataset$DOMESTIC <- as.factor(crimeDataset$DOMESTIC)
```


Provjeravamo fale li nam neki podaci u najbitnim kategorijama u oba dataseta.

```{r}
s <-c(1,2,3,4,5,6,8,9) 
sum(is.na(crimeDataset[s]))
sum(is.na(povertyDataset))
```


## Razlika učestalosti zločina ovisno o tome koje je doba dana

Podijelit ćemo dan na 3 dijela. Od 5 do 13 će biti prvi dio dana. Od 13 do 21
drugi dio dana, a od 21 do 5 treći dio dana.

```{r}

timeOfTheDay <- mdy_hms(crimeDataset$DATE..OF.OCCURRENCE) %>% hour
timeOfTheDay <- sapply(timeOfTheDay, function(x) {
  if(x >= 5 & x < 13) {
    "morning"
  } else if(x >= 13 & x < 21) {
    "afternoon"
  } else {
    "evening"
  }
},simplify="vector")
timeOfTheDay <- as.factor(timeOfTheDay)
crimeDataset$TIME.OF.DAY <- timeOfTheDay
head(crimeDataset[c("DATE..OF.OCCURRENCE","TIME.OF.DAY")])
pie(table(crimeDataset$TIME.OF.DAY))
```



Napravit ćemo test o homogenosti u kojem želimo viditi postoji li razlika u 
količini zločina s obzirom na doba dana.

Napravit ćemo test homogenosti u kojem ćemo provjeriti je li broj zločina 
opasnih po život jednak za sva 3 doba dana. Zločine koje smo uzeli da su 
opasni po život nalaze se u varijabli `dangCrimes`.

```{r, echo=FALSE}
dangCrimes <- c("ARSON", "ASSAULT","BATTERY","BURGLARY","CRIM SEXUAL ASSAULT",
                "CRIMINAL DAMAGE", "CRIMINAL SEXUAL ASSAULT","CRIMINAL TRESPASS"
                , "HOMICIDE","KIDNAPPING")
dangerousCrimes <- ifelse(crimeDataset$PRIMARY.DESCRIPTION %in% dangCrimes
                      ,"dangerous","less dangerous") %>% as.factor
kable(table(dangerousCrimes))
dangerous <- table(crimeDataset$TIME.OF.DAY, dangerousCrimes)
kable(dangerous)
chisq.test(dangerous, correct = FALSE)
```

Zaključujemo da se razlikuje količina opasnih i neopasnih zločina ovisno o tome
koje je doba dana.

##Korelacija između zločina i socio ekonomskih faktora

```{r}

library("ggpubr")
ggscatter(povertyDataset, x = "Unemployment", y = "Firearm.related", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Unemployment percentage", ylab = "Firearm-related crimes per 100 000 residents")
ggscatter(povertyDataset, x = "Unemployment", y = "Assault..Homicide.", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Unemployment percentage", ylab = "Assaults(Homicide) per 100 000 residents")

ggscatter(povertyDataset, x = "Below.Poverty.Level", y = "Firearm.related", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Percentage of people below poverty level", ylab = "Firearm-related crimes per 100 000 residents")
ggscatter(povertyDataset, x = "Below.Poverty.Level", y = "Assault..Homicide.", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Percentage of people below poverty level", ylab = "Assaults(Homicide) per 100 000 residents")

ggscatter(povertyDataset, x = "Dependency", y = "Firearm.related", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Dependecy percentage", ylab = "Firearm-related crimes per 100 000 residents")
ggscatter(povertyDataset, x = "Dependency", y = "Assault..Homicide.", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Dependecy percentage", ylab = "Assaults(Homicide) per 100 000 residents")

```

## Je li učestalost krađa veća od učestalosti kriminala vezanih za narkotike?

U varijablu 'description' odvajamo objekt PRIMARY.DESCRIPTION iz našeg skupa podataka crimeDataset. Zatim tu varijablu pretvara u skup podataka ali na način da se sve iste vrijednosti prebroje i upišu u stupaca Freq. U varijable krada i narkotici odvojimo podatke vezane za te zlocine. U varijable broj_krada i broj_narkotici zatim stavljamo sumu retka freq iz prethodnih varijabli.


```{r}
description <- crimeDataset$PRIMARY.DESCRIPTION

description <- as.data.frame(table(description))

krada <- description[c(18, 28, 31),]
narkotici <- description[c(19, 23),]

broj_krada <- sum(krada$Freq)
broj_narkotici <- sum(narkotici$Freq)

cat("Učestalost krađa: ")
broj_krada
cat("\n")
cat("Učestalost kriminala vezanih za narkotike: ")
broj_narkotici
cat("\n")
```


```{r jednostavna regresija}

fit.FirearmUnemployment = lm(Firearm.related~Unemployment,data=povertyDataset) #model za regresiju

plot(povertyDataset$Firearm.related,povertyDataset$Unemployment) #graficki prikaz podataka

selected.model = fit.FirearmUnemployment

#histogrami
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

#KS test na normalnost 
ks.test(rstandard(fit.FirearmUnemployment),'pnorm')

require(nortest)
lillie.test(rstandard(fit.FirearmUnemployment))

summary(fit.FirearmUnemployment)

fit.AssaultUnemployment = lm(Assault..Homicide.~Unemployment,data=povertyDataset) #model za regresiju

plot(povertyDataset$Assault..Homicide.,povertyDataset$Unemployment) #graficki prikaz podataka

selected.model = fit.AssaultUnemployment

#histogrami
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

#KS test na normalnost 
ks.test(rstandard(fit.AssaultUnemployment),'pnorm')

require(nortest)
lillie.test(rstandard(fit.AssaultUnemployment))
summary(fit.AssaultUnemployment)

fit.FirearmBelowPovertyLevel = lm(Firearm.related~Below.Poverty.Level,data=povertyDataset) #model za regresiju

plot(povertyDataset$Firearm.related,povertyDataset$Below.Poverty.Level) #graficki prikaz podataka

selected.model = fit.FirearmBelowPovertyLevel

#histogrami
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

#KS test na normalnost 
ks.test(rstandard(fit.FirearmBelowPovertyLevel),'pnorm')

require(nortest)
lillie.test(rstandard(fit.FirearmBelowPovertyLevel))

summary(fit.FirearmBelowPovertyLevel)

fit.AssaultBelowPovertyLevel = lm(Assault..Homicide.~Below.Poverty.Level,data=povertyDataset) #model za regresiju

plot(povertyDataset$Assault..Homicide.,povertyDataset$Below.Poverty.Level) #graficki prikaz podataka

selected.model = fit.AssaultBelowPovertyLevel

#histogrami
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

#KS test na normalnost 
ks.test(rstandard(fit.AssaultBelowPovertyLevel),'pnorm')

require(nortest)
lillie.test(rstandard(fit.AssaultBelowPovertyLevel))
summary(fit.AssaultBelowPovertyLevel)

fit.FirearmDependency = lm(Firearm.related~Dependency,data=povertyDataset) #model za regresiju

plot(povertyDataset$Firearm.related,povertyDataset$Dependency) #graficki prikaz podataka

selected.model = fit.FirearmDependency

#histogrami
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

#KS test na normalnost 
ks.test(rstandard(fit.FirearmDependency),'pnorm')

require(nortest)
lillie.test(rstandard(fit.FirearmDependency))

summary(fit.FirearmDependency)

fit.AssaultDependency = lm(Assault..Homicide.~Dependency,data=povertyDataset) #model za regresiju

plot(povertyDataset$Assault..Homicide.,povertyDataset$Dependency) #graficki prikaz podataka

selected.model = fit.AssaultDependency

#histogrami
hist((selected.model$residuals))
hist(rstandard(selected.model))

#q-q plot
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))

#KS test na normalnost 
ks.test(rstandard(fit.AssaultDependency),'pnorm')

require(nortest)
lillie.test(rstandard(fit.AssaultDependency))
summary(fit.AssaultDependency)

```


## Višestruka regresija

```{r visestruke regresija}

cor(cbind(povertyDataset$Below.Poverty.Level,povertyDataset$Per.Capita.Income,povertyDataset$Crowded.Housing,povertyDataset$Dependency,povertyDataset$No.High.School.Diploma,povertyDataset$Unemployment)) # provjera korelacijskih koeficijenata za sve parove regresora

fit.Firearm1 = lm(Firearm.related ~ Unemployment + Below.Poverty.Level, povertyDataset) 
summary(fit.Firearm1)

fit.Firearm4 = lm(Firearm.related ~ No.High.School.Diploma + Unemployment, povertyDataset) 
summary(fit.Firearm4)

fit.Firearm5 = lm(Firearm.related ~ I(Below.Poverty.Level^2) + Per.Capita.Income, povertyDataset) 
summary(fit.Firearm5)

fit.Firearm6 = lm(Firearm.related ~ Per.Capita.Income + Crowded.Housing, povertyDataset) 
summary(fit.Firearm6)

fit.Firearm7 = lm(Firearm.related ~ Dependency + No.High.School.Diploma + Below.Poverty.Level, povertyDataset) 
summary(fit.Firearm7)

fit.Firearm8 = lm(Firearm.related ~ Dependency + No.High.School.Diploma + Unemployment, povertyDataset) 
summary(fit.Firearm8)

fit.Firearm9 = lm(Firearm.related ~ Dependency + No.High.School.Diploma + Unemployment + Below.Poverty.Level, povertyDataset) 
summary(fit.Firearm9)

fit.Assault1 = lm(Assault..Homicide. ~ Unemployment + Below.Poverty.Level, povertyDataset) 
summary(fit.Assault1)

fit.Assault4 = lm(Assault..Homicide. ~ No.High.School.Diploma + Unemployment, povertyDataset) 
summary(fit.Assault4)

fit.Assault5 = lm(Assault..Homicide. ~ I(Below.Poverty.Level^2) + Per.Capita.Income, povertyDataset) 
summary(fit.Assault5)

fit.Assault6 = lm(Assault..Homicide. ~ Per.Capita.Income + Crowded.Housing, povertyDataset) 
summary(fit.Assault6)

fit.Assault7 = lm(Assault..Homicide. ~ Dependency + No.High.School.Diploma + Below.Poverty.Level, povertyDataset) 
summary(fit.Assault7)

fit.Assault8 = lm(Assault..Homicide. ~ Dependency + No.High.School.Diploma + Unemployment, povertyDataset) 
summary(fit.Assault8)

fit.Assault9 = lm(Assault..Homicide. ~ Dependency + No.High.School.Diploma + Unemployment + Below.Poverty.Level, povertyDataset) 
summary(fit.Assault9)
```
